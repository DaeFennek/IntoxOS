###########################################################################
#
# -------------------------------------------------------------------------
#  File name:   makefile
#  Version:     v1.00
#  Created:     29/3/2014 by Kevin.
#  Description: This makefile will compile and link the IntoxOS
# -------------------------------------------------------------------------
#  History:
#
###########################################################################

CC=i586-elf-gcc
CFLAGS=-Wall -O -fstrength-reduce -fomit-frame-pointer -nostdinc -fno-builtin -fno-strict-aliasing -fno-common -fno-stack-protector
LD=i586-elf-ld
ASM=nasm
ASMBIN=bin
ASMELF=elf
ASMFLAGS=-O32 -f
current_dir=$(shell pwd)
objDir=C:/Users/Kevin/Desktop/IntoxOS/IntoxOS/object_files

all:
	$(ASM) $(ASMFLAGS) $(ASMBIN) boot.asm -o boot.bin
	$(ASM) $(ASMFLAGS) $(ASMELF) SecondStageLoader.asm -o $(objDir)/SecondStageLoader.o
	$(CC) -c kmain.c -o $(objDir)/kmain.o
	i586-elf-ld -T kernel.ld $(objDir)/SecondStageLoader.o $(objDir)/kmain.o
		
	mv a.out kernel.bin
	cmd /c copy /b boot.bin + kernel.bin IntoxOS.bin